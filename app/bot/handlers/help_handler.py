# app/bot/handlers/help_handler.py - –ù–æ–≤—ã–π —Ñ–∞–π–ª —Å –∫–æ–º–∞–Ω–¥–æ–π /help
from telegram import Update
from telegram.ext import ContextTypes
import logging

logger = logging.getLogger(__name__)

HELP_TEXT = """
ü§ñ **–¢–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç - –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º**

üìä **–ü–†–û–°–ú–û–¢–† –ò–ù–§–û–†–ú–ê–¶–ò–ò:**
‚Ä¢ `balance` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞
‚Ä¢ `positions` ‚Äî –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏
‚Ä¢ `status` ‚Äî –æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å —Å—á–µ—Ç–∞
‚Ä¢ `settings` ‚Äî —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞

üíπ **–¢–û–†–ì–û–í–´–ï –û–ü–ï–†–ê–¶–ò–ò:**
‚Ä¢ `buy SBER` ‚Äî –∫—É–ø–∏—Ç—å SBER –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º —Ä–∏—Å–∫–∞
‚Ä¢ `sell GAZP` ‚Äî –ø—Ä–æ–¥–∞—Ç—å GAZP –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º —Ä–∏—Å–∫–∞
‚Ä¢ `close all` ‚Äî –∑–∞–∫—Ä—ã—Ç—å –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –∏ –æ—Ç–º–µ–Ω–∏—Ç—å –æ—Ä–¥–µ—Ä–∞

‚öôÔ∏è **–ù–ê–°–¢–†–û–ô–ö–ò –¢–û–†–ì–û–í–õ–ò:**
‚Ä¢ `set risk 40/30` ‚Äî —Ä–∏—Å–∫ –ª–æ–Ω–≥/—à–æ—Ä—Ç (–≤ %)
‚Ä¢ `set risk long 35` ‚Äî —Ç–æ–ª—å–∫–æ —Ä–∏—Å–∫ –ª–æ–Ω–≥–∞
‚Ä¢ `set risk short 25` ‚Äî —Ç–æ–ª—å–∫–æ —Ä–∏—Å–∫ —à–æ—Ä—Ç–∞
‚Ä¢ `set sl 0.7` ‚Äî —Å—Ç–æ–ø-–ª–æ—Å—Å (–≤ %)
‚Ä¢ `set tp 5.0` ‚Äî –±–∞–∑–æ–≤—ã–π —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç (–≤ %)

üéØ **–ú–£–õ–¨–¢–ò-TP –ù–ê–°–¢–†–û–ô–ö–ò:**
‚Ä¢ `set multi on` ‚Äî –≤–∫–ª—é—á–∏—Ç—å –º—É–ª—å—Ç–∏-TP
‚Ä¢ `set multi off` ‚Äî –≤—ã–∫–ª—é—á–∏—Ç—å –º—É–ª—å—Ç–∏-TP  
‚Ä¢ `set tp levels 0.5,1.0,1.6` ‚Äî —É—Ä–æ–≤–Ω–∏ TP (–≤ %)
‚Ä¢ `set tp portions 33,33,34` ‚Äî –¥–æ–ª–∏ –ø–æ–∑–∏—Ü–∏–∏ (–≤ %)

‚è∞ **–ê–í–¢–û-–õ–ò–ö–í–ò–î–ê–¶–ò–Ø:**
‚Ä¢ `set auto on/off` ‚Äî –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å
‚Ä¢ `set auto time 21:44` ‚Äî –≤—Ä–µ–º—è –∑–∞–∫—Ä—ã—Ç–∏—è (–ú–°–ö)
‚Ä¢ `set auto block 30` ‚Äî –æ–∫–Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–º–∏–Ω)
‚Ä¢ `set auto days 0,1,2,3,4` ‚Äî –¥–Ω–∏ (0=–ü–Ω, 6=–í—Å)

üåê **WEBHOOK API:**
```
POST /webhook
{
  "action": "buy",
  "symbol": "SBER", 
  "quantity": 5,
  "tp_percent": 1.5,
  "sl_percent": 0.8
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã webhook:**
‚Ä¢ `action` ‚Äî "buy" –∏–ª–∏ "sell"
‚Ä¢ `symbol` ‚Äî —Ç–∏–∫–µ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
‚Ä¢ `quantity` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚Ä¢ `risk_percent` ‚Äî —Ä–∏—Å–∫ –≤ % (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚Ä¢ `tp_percent` ‚Äî –∫–∞—Å—Ç–æ–º–Ω—ã–π TP –≤ % (–æ—Ç–∫–ª—é—á–∞–µ—Ç –º—É–ª—å—Ç–∏-TP)
‚Ä¢ `sl_percent` ‚Äî –∫–∞—Å—Ç–æ–º–Ω—ã–π SL –≤ %

üìù **–ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:**

*–¢–æ—Ä–≥–æ–≤–ª—è:*
```
buy SBER
sell GAZP  
close all
```

*–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∏—Å–∫–æ–≤:*
```
set risk 50/40
set sl 1.2
set tp 8.0
```

*–ú—É–ª—å—Ç–∏-TP:*
```
set multi on
set tp levels 0.3,0.8,1.5
set tp portions 30,40,30
```

*–ê–≤—Ç–æ-–ª–∏–∫–≤–∏–¥–∞—Ü–∏—è:*
```
set auto on
set auto time 21:30
set auto days 0,1,2,3,4
```

‚ÑπÔ∏è **–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û:**
‚Ä¢ –í—Å–µ –ø—Ä–æ—Ü–µ–Ω—Ç—ã —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (1.5 = 1.5%)
‚Ä¢ –ú—É–ª—å—Ç–∏-TP –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∏—Ç –ø–æ–∑–∏—Ü–∏—é –Ω–∞ —á–∞—Å—Ç–∏
‚Ä¢ –ê–≤—Ç–æ-–ª–∏–∫–≤–∏–¥–∞—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –≤ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
‚Ä¢ Webhook –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∑–∞ 30 –º–∏–Ω –¥–æ –∞–≤—Ç–æ-–ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
"""

async def handle_help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
    message = update.message or update.channel_post
    if not message:
        return
    
    try:
        await message.reply_text(HELP_TEXT, parse_mode='Markdown')
        logger.info("Help command executed successfully")
    except Exception as e:
        logger.error(f"Error in help command: {e}")
        # –ï—Å–ª–∏ Markdown –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–∫ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
        await message.reply_text(HELP_TEXT.replace('*', '').replace('`', ''))

async def handle_help_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏—è 'help' (–±–µ–∑ /)"""
    await handle_help_command(update, context)