# trading_bot_tg_webhooks
# üì° Trading Bot —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Telegram –∏ Tinkoff Invest API

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç ‚Äî —Ç–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç **—Å–∏–≥–Ω–∞–ª—ã —á–µ—Ä–µ–∑ –≤–µ–±—Ö—É–∫–∏**, —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è **—á–µ—Ä–µ–∑ Telegram**, –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–æ—Ä–≥—É–µ—Ç —á–µ—Ä–µ–∑ **Tinkoff Invest API**.

---
# –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

* app/webhook_server.py ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä –≤–µ–±—Ö—É–∫–æ–≤.
* app/trading/tinkoff_client.py ‚Äî —Ä–∞–±–æ—Ç–∞ —Å API –¢–∏–Ω—å–∫–æ—Ñ—Ñ.
* app/trading/order_executor.py ‚Äî –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤.
* app/trading/settings_manager.py ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ risk/SL/TP.
* app/bot/ (handlers, utils) ‚Äî –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞ –∏ –∫–æ–º–∞–Ω–¥—ã –≤ Telegram.
* db/bot_settings.json ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫.
* docker-compose.yml + Dockerfile ‚Äî –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
* README.md –∏ API_DOCUMENTATION.md ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ü—Ä–∏—ë–º —Å–∏–≥–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ Webhook API (`buy`, `sell`, `close_all`, `balance`).
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è –ø–æ —Å–∏–≥–Ω–∞–ª–∞–º —Å —É—á—ë—Ç–æ–º —Ä–∏—Å–∫–∞.
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º —á–µ—Ä–µ–∑ **Telegram**:
  - üí∞ –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞
  - üìä –°–ø–∏—Å–æ–∫ –ø–æ–∑–∏—Ü–∏–π
  - üîç –ü–æ–∏—Å–∫ FIGI –ø–æ —Ç–∏–∫–µ—Ä—É
  - ‚úÖ –ü–æ–∫—É–ø–∫–∞ / –ø—Ä–æ–¥–∞–∂–∞
  - üõë –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π
  - ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ risk/stop-loss/take-profit –ø—Ä—è–º–æ –≤ —á–∞—Ç–µ
- üì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –æ–± –æ–ø–µ—Ä–∞—Ü–∏—è—Ö –∏ –æ—à–∏–±–∫–∞—Ö.
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π stop-loss –∏ take-profit.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
üìÅ app
 ‚îú‚îÄ‚îÄ üìÅ bot            # Telegram-–±–æ—Ç
 ‚îÇ    ‚îú‚îÄ‚îÄ handlers     # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
 ‚îÇ    ‚îî‚îÄ‚îÄ main.py      # –¢–æ—á–∫–∞ –∑–∞–ø—É—Å–∫–∞ Telegram-–±–æ—Ç–∞
 ‚îú‚îÄ‚îÄ üìÅ trading        # –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –±—Ä–æ–∫–µ—Ä–æ–º
 ‚îÇ    ‚îú‚îÄ‚îÄ tinkoff_client.py   # –†–∞–±–æ—Ç–∞ —Å API Tinkoff
 ‚îÇ    ‚îú‚îÄ‚îÄ order_executor.py   # –í—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤
 ‚îÇ    ‚îú‚îÄ‚îÄ order_watcher.py    # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
 ‚îÇ    ‚îú‚îÄ‚îÄ settings_manager.py # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ risk/sl/tp
 ‚îÇ    ‚îî‚îÄ‚îÄ risk_manager.py
 ‚îú‚îÄ‚îÄ üìÑ webhook_server.py     # Webhook API
 ‚îú‚îÄ‚îÄ üìÑ notifications.py      # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram
 ‚îú‚îÄ‚îÄ üìÑ config.py             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (env)
 ‚îú‚îÄ‚îÄ üìÑ requirements.txt      # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
 ‚îú‚îÄ‚îÄ üìÑ Dockerfile            # Docker —Å–±–æ—Ä–∫–∞
 ‚îî‚îÄ‚îÄ üìÑ docker-compose.yml    # –ú–Ω–æ–≥–æ–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫
üìÅ db
 ‚îî‚îÄ‚îÄ init.sql                 # SQL-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
.env                          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç
```bash
git clone git@github.com:mowertii/trading_bot_tg_webhooks.git
cd trading_bot_tg_webhooks
```

### 2. –ó–∞–ø–æ–ª–Ω—è–µ–º `.env`
–ü—Ä–∏–º–µ—Ä:
```ini
BOT_TOKEN=–≤–∞—à_telegram_token
TG_CHAT_ID=–≤–∞—à_telegram_chat_id
TINKOFF_TOKEN=–≤–∞—à_tinkoff_api_token
ACCOUNT_ID=–≤–∞—à_account_id
REDIS_URL=redis://redis:6379/0
POSTGRES_DB=trading_data
POSTGRES_USER=bot
POSTGRES_PASSWORD=11111111
DB_URL=postgresql://bot:11111111@db:5432/trading_data
WEBHOOK_SECRET=—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á
WEBHOOK_PORT=8080
WEBHOOK_HOST=0.0.0.0
```

### 3. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker
```bash
docker-compose up --build -d
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞
- Health check:
  ```bash
  curl http://localhost:8080/health
  ```
- –õ–æ–≥–∏:
  ```bash
  docker-compose logs -f webhook-bot
  ```

---

## üí¨ Telegram –∫–æ–º–∞–Ω–¥—ã

- `–±–∞–ª–∞–Ω—Å` / `balance` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å
- `—Å–æ—Å—Ç–æ—è–Ω–∏–µ` / `positions` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏
- `figi SBER` ‚Äî –Ω–∞–π—Ç–∏ FIGI
- `buy SBER` ‚Äî –∫—É–ø–∏—Ç—å
- `sell GAZP` ‚Äî –ø—Ä–æ–¥–∞—Ç—å
- `close all` ‚Äî –∑–∞–∫—Ä—ã—Ç—å –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏
- `settings` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `set risk 40/30` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —Ä–∏—Å–∫ (–ª–æ–Ω–≥/—à–æ—Ä—Ç)
- `set risk long 35` ‚Äî —Ä–∏—Å–∫ —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–Ω–≥–∞
- `set risk short 25` ‚Äî —Ä–∏—Å–∫ —Ç–æ–ª—å–∫–æ –¥–ª—è —à–æ—Ä—Ç–∞
- `set sl 0.7` ‚Äî —Å—Ç–æ–ø-–ª–æ—Å—Å (%)
- `set tp 9` ‚Äî —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç (%)
- `/help` ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ 

---

## üîå API Webhook

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ [API_DOCUMENTATION.md](./API_DOCUMENTATION.md).

–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:
# –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å–¥–µ–ª–∫–∏ –ø–æ —Ä–∏—Å–∫—É –≤ % –æ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤, —Å —É—á—ë—Ç–æ–º –ø–ª–µ—á–∞ –õ–û–ö–ê–õ–¨–ù–û
```bash
curl -X POST http://localhost:8080/webhook \
  -H "Content-Type: application/json" \
  -d '{"action": "buy", "symbol": "SBER", "risk_percent": 0.4}'
```
# –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å–¥–µ–ª–æ–∫ —Å—Ç—Ä–æ–≥–æ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∏—Å–∫–∞ –£–î–ê–õ–Å–ù–ù–û
curl -X POST https://webhook.example.ru/webhook?token=<WEBHOOK_SECRET> \
  -H 'Content-Type: application/json' \
  -d '{"action":"sell","symbol":"GZU5","quantity":1}'  
---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Python 3.11
- [python-telegram-bot](https://docs.python-telegram-bot.org/)
- [tinkoff-investments](https://tinkoff.github.io/investAPI/)
- Docker + docker-compose
- Redis, PostgreSQL
- Gunicorn + aiohttp

---

## üìà –î–∞–ª—å–Ω–µ–π—à–∏–µ –ø–ª–∞–Ω—ã

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π stop-loss / take-profit (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- üìä –û—Ç—á—ë—Ç—ã –ø–æ —Å–¥–µ–ª–∫–∞–º
- üîî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- ü§ñ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ML –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
- üåê –í–µ–±-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏ –¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã.
